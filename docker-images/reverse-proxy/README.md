# Teaching-HEIGVD-RES-2018-Labo-HTTPInfra

## Reverse-proxy

### Description

This folder contain all material needed in order to create a reverse proxy. It's used with docker. The base docker image is the `php:7.0-apache` from official docker-hub. At this step the ip addresses of the two destination containers are dynamically saved in the configuration file. The configuration file is generated when you run the container. It's generated by a php script. You can access the reverse proxy by the host name `demo.res.ch`. When you access to the address *demo.res.ch:PORT/api/animals/*, you can see the JSON table of random animals. When you access to the address *demo.res.ch:PORT/*, you can see the static web page. (Explaination about the port in the next section)

### Instruction

1. First you need to open a terminal in the **reverse-proxy** folder.
2. To build the docker container run the following command : `docker build -t YourContainerName .`
3. You need to launch the 2 previous docker containers and edit the 001-revers-proxy.conf file. In this file, you need to set the ip addresses of the 2 previous docker containers.
5. You need to add the host in your host file on your machine.
4. To run the container : `docker run -d -p PORT:80 -e STATIC_APP=ipAddressOfTheStaticWebPage:80 -e DYNAMIC_APP=ipAddressOfTheExpressApp:3000 YourContainerName`. For exemple , if you run the following command : `docker run -d -p 8080:80 -e STATIC_APP=172.17.0.2:80 -e DYNAMIC_APP=172.17.0.3:3000 YourContainerName`, you can access the applications with the following url : *demo.res.ch:8080/*, the ip address of the web page is 172.17.0.2 and the ip address of the express application is 172.17.0.3
6. Enjoy your application !
